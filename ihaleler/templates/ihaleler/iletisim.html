{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEYSA TEKNİK | İletişim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --ekap-blue: #1a5695; --bg-gray: #f4f7fa; --text-primary: #2d2d2d; --border-mid: #e0e0e0; }
        body { background-color: var(--bg-gray); font-family: 'Source Sans 3', system-ui, sans-serif; color: var(--text-primary); }
        .ekap-navbar { padding: 15px 40px; background: white; border-bottom: 1px solid var(--border-mid); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .nav-capsule { background: #f8f9fa; border-radius: 50px; padding: 6px 20px; border: 1px solid var(--border-mid); display: flex; gap: 14px; align-items: center; }
        .nav-capsule a { text-decoration: none; color: var(--text-primary); font-size: 13px; font-weight: 500; white-space: nowrap; }
        .nav-capsule a:hover { color: var(--ekap-blue); }
        .nav-upload-btn { background: var(--ekap-blue); color: white !important; padding: 6px 15px; border-radius: 20px; font-weight: 700; }
        .nav-user-block { display: flex; align-items: center; gap: 10px; background: #f8f9fa; padding: 8px 14px; border-radius: 50px; border: 1px solid #e9ecef; }
        .nav-user-block .nav-username { font-size: 13px; font-weight: 600; color: var(--ekap-blue); text-transform: uppercase; letter-spacing: 0.3px; }
        .nav-user-block .btn-logout { font-size: 12px; padding: 5px 12px; border-radius: 20px; font-weight: 600; }
        .iletisim-wrap { max-width: 520px; margin: 0 auto; }
        .page-title-with-icon { display: inline-flex; align-items: center; gap: 8px; }
        .page-title-with-icon .icon-right { margin-left: 6px; color: var(--ekap-blue); }
        .kutu { background: white; border-radius: 12px; border: 1px solid var(--border-mid); padding: 24px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
        .sonuc-kutu { background: #f0f7ff; border-left: 4px solid var(--ekap-blue); padding: 16px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>

<nav class="ekap-navbar">
    <a href="{% url 'ana_sayfa' %}"><img src="{% static 'img/meysa_logo.jpeg' %}" style="height: 55px;"></a>
    <div class="nav-capsule">
        <a href="{% url 'ana_sayfa' %}">Anasayfa</a>
        <a href="{% url 'ihale_listesi' %}">İhaleler</a>
        <a href="{% url 'dogrudan_temin_listesi' %}">Doğrudan Teminler</a>
        <a href="{% url 'dosya_yukleme' %}" class="nav-upload-btn"><i class="fas fa-cloud-upload-alt me-1"></i> Dosya Yükleme</a>
        <a href="{% url 'arabalar' %}">Arabalar</a>
        <div style="width:1px; height:20px; background:#ddd;"></div>
        <a href="{% url 'analiz' %}">Analiz</a>
        <a href="{% url 'mesailerim' %}">Mesailerim</a>
        <a href="{% url 'profilim' %}" style="color: #28a745; font-weight: 700;">Profilim</a>
        <a href="{% url 'iletisim' %}">İletişim <i class="fas fa-phone-alt ms-1 icon-right"></i></a>
    </div>
    <div class="nav-user-block">
        <span class="nav-username">{{ user.username }}</span>
        <form action="/admin/logout/" method="post" style="display:inline; margin:0;">{% csrf_token %}<button type="submit" class="btn btn-sm btn-outline-danger btn-logout">Çıkış</button></form>
    </div>
</nav>

<div class="container py-4">
    <div class="iletisim-wrap text-center mb-4">
        <h5 class="fw-bold mb-2 page-title-with-icon">İletişim <i class="fas fa-phone-alt icon-right"></i></h5>
        <p class="text-muted small mb-0">İl, ilçe ve hastane seçin; ulaşmak istediğiniz görevi işaretleyin.</p>
    </div>
    <div class="iletisim-wrap">
    <form method="get" action="{% url 'iletisim' %}" id="iletisimForm">
        <div class="kutu">
            <div class="mb-3">
                <label class="form-label small fw-bold">İl</label>
                <select name="il" class="form-select form-select-sm" id="ilSelect" onchange="this.form.submit()">
                    <option value="">Seçiniz</option>
                    {% for i in iller %}
                    <option value="{{ i }}" {% if request.GET.il == i %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label small fw-bold">İlçe</label>
                <select name="ilce" class="form-select form-select-sm" id="ilceSelect" onchange="this.form.submit()">
                    <option value="">Tümü</option>
                    {% for ic in ilce_list %}
                    <option value="{{ ic }}" {% if request.GET.ilce == ic %}selected{% endif %}>{{ ic }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label small fw-bold">Hastane</label>
                <select name="hastane" class="form-select form-select-sm" id="hastaneSelect">
                    <option value="">Seçiniz</option>
                    {% for hid, had in hastaneler %}
                    <option value="{{ hid }}" {% if request.GET.hastane == hid|stringformat:"d" %}selected{% endif %}>{{ had }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="mb-0">
                <label class="form-label small fw-bold">Hangi görevdeki kişiye ulaşacaksınız?</label>
                <div class="row g-2">
                    {% for g in gorevler %}
                    <div class="col-12 col-md-6">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="gorev" value="{{ g }}" id="g{{ forloop.counter }}">
                            <label class="form-check-label small" for="g{{ forloop.counter }}">{{ g }}</label>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary btn-sm">Göster</button>
    </form>

    {% if request.GET.hastane or request.GET.gorev %}
    <div class="sonuc-kutu">
        <h6 class="fw-bold mb-2"><i class="fas fa-info-circle me-1"></i> İletişim bilgileri</h6>
        <p class="mb-0 small text-muted">Seçtiğiniz birim için iletişim bilgileri burada listelenecektir. Sistemde kayıtlı numaralar eklendiğinde bu alanda görüntülenecektir.</p>
    </div>
    {% endif %}
    </div>
</div>

<script>
document.getElementById('ilSelect').addEventListener('change', function() {
    var ilce = document.getElementById('ilceSelect');
    ilce.innerHTML = '<option value="">Tümü</option>';
});
</script>
</body>
</html>
