{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEYSA TEKNİK | İhale Portalı</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --ekap-blue: #1a5695; --bg-gray: #f4f7fa; }
        body { background-color: var(--bg-gray); font-family: 'Segoe UI', sans-serif; }
        .ekap-navbar { padding: 10px 50px; background: white; border-bottom: 1px solid #e0e6ed; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .nav-capsule { background: #f8f9fa; border-radius: 50px; padding: 5px 25px; border: 1px solid #eee; display: flex; gap: 15px; align-items: center; }
        .nav-capsule a { text-decoration: none; color: #444; font-size: 14px; font-weight: 500; }

        .portal-container { display: flex; padding: 25px 50px; gap: 25px; }
        .filter-panel { width: 330px; background: white; border-radius: 12px; padding: 20px; border: 1px solid #e0e6ed; height: fit-content; }
        .filter-title { font-weight: bold; border-bottom: 2px solid var(--ekap-blue); padding-bottom: 8px; margin-bottom: 15px; }
        .filter-group { margin-bottom: 15px; }
        .filter-group label { font-size: 13px; font-weight: 600; color: #555; display: block; margin-bottom: 5px; }
        
        .ikn-grid { display: grid; grid-template-columns: 1fr auto 2fr; align-items: center; gap: 5px; }
        
        .content-area { flex: 1; }
        .search-row { background: white; padding: 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e0e6ed; display: flex; gap: 10px; align-items: center; }
        
        .ihale-card { background: white; border-radius: 12px; border: 1px solid #e0e6ed; padding: 20px; margin-bottom: 12px; }
        .ihale-main-link { color: #1a5695; font-size: 16px; font-weight: 700; text-decoration: none; cursor: pointer; }
        .kalemler-box { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd; }
    </style>
</head>
<body>

    <nav class="ekap-navbar shadow-sm">
        <img src="{% static 'img/meysa_logo.jpeg' %}" style="height: 50px;">
        <div class="nav-capsule">
            <a href="/">Anasayfa</a>
            <a href="/listele/" class="fw-bold text-primary">İhaleler</a>
            <a href="#">Doğrudan Teminler</a>
            <a href="#">Sorgulamalar</a>
            <a href="#">Arabalar</a>
            <div style="width:1px; height:20px; background:#ddd;"></div>
            <a href="#" class="text-primary">Mesailerim</a>
            <a href="#" class="text-primary">İletişim</a>
        </div>
        <div class="fw-bold">{{ user.username|upper }}</div>
    </nav>

    <div class="portal-container">
        <aside class="filter-panel shadow-sm">
            <div class="filter-title">Detaylı Filtre</div>
            <form method="GET">
                <div class="filter-group">
                    <label>İhale Kayıt Numarası (İKN)</label>
                    <div class="ikn-grid">
                        <input type="text" name="ikn_yil" class="form-control form-control-sm" placeholder="Yıl">
                        <span>/</span>
                        <input type="text" name="ikn_no" class="form-control form-control-sm" placeholder="No">
                    </div>
                </div>

                <div class="filter-group">
                    <label>İl</label>
                    <select id="il-select" name="il" class="form-select form-select-sm" onchange="ilceGuncelle()">
                        <option value="">İl Seçiniz</option>
                        </select>
                </div>

                <div class="filter-group">
    <label>İl</label>
    <select id="il-select" name="il" class="form-select form-select-sm" onchange="ilceGuncelle()">
        <option value="">İl Seçiniz</option>
        <option value="İstanbul">İSTANBUL</option>
        <option value="Adana">ADANA</option>
        <option value="Adıyaman">ADIYAMAN</option>
        <option value="Afyonkarahisar">AFYONKARAHİSAR</option>
        <option value="Ağrı">AĞRI</option>
        <option value="Amasya">AMASYA</option>
        <option value="Ankara">ANKARA</option>
        <option value="Antalya">ANTALYA</option>
        <option value="Artvin">ARTVİN</option>
        <option value="Aydın">AYDIN</option>
        <option value="Balıkesir">BALIKESİR</option>
        <option value="Bilecik">BİLECİK</option>
        <option value="Bingöl">BİNGÖL</option>
        <option value="Bitlis">BİTLİS</option>
        <option value="Bolu">BOLU</option>
        <option value="Burdur">BURDUR</option>
        <option value="Bursa">BURSA</option>
        <option value="Çanakkale">ÇANAKKALE</option>
        <option value="Çankırı">ÇANKIRI</option>
        <option value="Çorum">ÇORUM</option>
        <option value="Denizli">DENİZLİ</option>
        <option value="Diyarbakır">DİYARBAKIR</option>
        <option value="Edirne">EDİRNE</option>
        <option value="Elazığ">ELAZIĞ</option>
        <option value="Erzincan">ERZİNCAN</option>
        <option value="Erzurum">ERZURUM</option>
        <option value="Eskişehir">ESKİŞEHİR</option>
        <option value="Gaziantep">GAZİANTEP</option>
        <option value="Giresun">GİRESUN</option>
        <option value="Gümüşhane">GÜMÜŞHANE</option>
        <option value="Hakkari">HAKKARİ</option>
        <option value="Hatay">HATAY</option>
        <option value="Isparta">ISPARTA</option>
        <option value="Mersin">MERSİN</option>
        <option value="İzmir">İZMİR</option>
        <option value="Kars">KARS</option>
        <option value="Kastamonu">KASTAMONU</option>
        <option value="Kayseri">KAYSERİ</option>
        <option value="Kırklareli">KIRKLARELİ</option>
        <option value="Kırşehir">KIRŞEHİR</option>
        <option value="Kocaeli">KOCAELİ</option>
        <option value="Konya">KONYA</option>
        <option value="Kütahya">KÜTAHYA</option>
        <option value="Malatya">MALATYA</option>
        <option value="Manisa">MANİSA</option>
        <option value="Kahramanmaraş">KAHRAMANMARAŞ</option>
        <option value="Mardin">MARDİN</option>
        <option value="Muğla">MUĞLA</option>
        <option value="Muş">MUŞ</option>
        <option value="Nevşehir">NEVŞEHİR</option>
        <option value="Niğde">NİĞDE</option>
        <option value="Ordu">ORDU</option>
        <option value="Rize">RİZE</option>
        <option value="Sakarya">SAKARYA</option>
        <option value="Samsun">SAMSUN</option>
        <option value="Siirt">SİİRT</option>
        <option value="Sinop">SİNOP</option>
        <option value="Sivas">SİVAS</option>
        <option value="Tekirdağ">TEKİRDAĞ</option>
        <option value="Tokat">TOKAT</option>
        <option value="Trabzon">TRABZON</option>
        <option value="Tunceli">TUNCELİ</option>
        <option value="Şanlıurfa">ŞANLIURFA</option>
        <option value="Uşak">UŞAK</option>
        <option value="Van">VAN</option>
        <option value="Yozgat">YOZGAT</option>
        <option value="Zonguldak">ZONGULDAK</option>
        <option value="Aksaray">AKSARAY</option>
        <option value="Bayburt">BAYBURT</option>
        <option value="Karaman">KARAMAN</option>
        <option value="Kırıkkale">KIRIKKALE</option>
        <option value="Batman">BATMAN</option>
        <option value="Şırnak">ŞIRNAK</option>
        <option value="Bartın">BARTIN</option>
        <option value="Ardahan">ARDAHAN</option>
        <option value="Iğdır">IĞDIR</option>
        <option value="Yalova">YALOVA</option>
        <option value="Karabük">KARABÜK</option>
        <option value="Kilis">KİLİS</option>
        <option value="Osmaniye">OSMANİYE</option>
        <option value="Düzce">DÜZCE</option>
    </select>
</div>

                <div class="filter-group">
                    <label>İhale Durumu</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="durum" value="Acik" id="d1">
                        <label class="form-check-label small" for="d1">Açık</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="durum" value="Kapali" id="d2">
                        <label class="form-check-label small" for="d2">Kapalı / Sonuçlanmış</label>
                    </div>
                </div>

                <div class="filter-group">
    <label>Alım Türü</label>
    <div class="d-flex flex-wrap gap-2">
        <input type="radio" class="btn-check" name="tur" id="t1" value="Mal">
        <label class="btn btn-outline-primary btn-sm px-3" for="t1">Mal</label>

        <input type="radio" class="btn-check" name="tur" id="t2" value="Yapim">
        <label class="btn btn-outline-primary btn-sm px-3" for="t2">Yapım</label>

        <input type="radio" class="btn-check" name="tur" id="t3" value="Hizmet">
        <label class="btn btn-outline-primary btn-sm px-3" for="t3">Hizmet</label>
    </div>
</div>

                <button type="submit" class="btn btn-primary btn-sm w-100 fw-bold">SORGULA</button>
            </form>
        </aside>

        <main class="content-area">
            <div class="search-row shadow-sm">
                <i class="fa fa-search text-muted px-2"></i>
                <input type="text" name="search" class="form-control border-0" placeholder="İhale adı, hastane veya ürün ara..." style="box-shadow:none;">
                
                <div style="width:1px; height:30px; background:#eee;"></div>
                
                <select name="sirala" class="form-select border-0 w-auto fw-bold" style="font-size: 13px; box-shadow:none;">
                    <option value="sisteme_yeni">Sisteme Giriş (Yeni > Eski)</option>
                    <option value="sisteme_eski">Sisteme Giriş (Eski > Yeni)</option>
                    <option value="ihale_eskiden_yeni">İhale Tarihi (Eskiden Yeniye)</option>
                    <option value="ihale_yeniden_eski">İhale Tarihi (Yeniden Eskiye)</option>
                </select>
            </div>

            {% for ihale in ihaleler %}
            <div class="ihale-card shadow-sm">
                <div class="d-flex justify-content-between">
                    <div>
                        <span class="badge bg-primary mb-2" style="font-size: 10px;">{{ ihale.tur }}</span>
                        <a class="ihale-main-link d-block" onclick="toggleKalemler('box-{{ ihale.id }}')">{{ ihale.ad }}</a>
                        <div class="small text-muted mt-1"><i class="fa fa-university me-1"></i> {{ ihale.hastane.ad }} | <b>{{ ihale.il }}</b></div>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold">{{ ihale.ikn }}</div>
                        <div class="small text-muted mt-2">İhale Tarihi:</div>
                        <div class="fw-bold">25.03.2026</div>
                    </div>
                </div>

                <div id="box-{{ ihale.id }}" class="kalemler-box">
                    <table class="table table-sm table-bordered mt-2">
                        <thead class="table-light"><tr><th>Sıra</th><th>Ürün Adı</th><th>Miktar</th><th class="text-end">Fiyat</th></tr></thead>
                        <tbody>
                            {% for kalem in ihale.kalemler.all %}
                            <tr><td>{{ forloop.counter }}</td><td>{{ kalem.urun_adi }}</td><td>{{ kalem.adet }}</td><td class="text-end fw-bold">{{ kalem.birim_fiyat }} ₺</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </main>
    </div>

    <script>
        const data = {
            "İstanbul": ["Adalar", "Arnavutköy", "Ataşehir", "Avcılar", "Bağcılar", "Bahçelievler", "Bakırköy", "Başakşehir", "Bayrampaşa", "Beşiktaş", "Beykoz", "Beylikdüzü", "Beyoğlu", "Büyükçekmece", "Çatalca", "Çekmeköy", "Esenler", "Esenyurt", "Eyüpsultan", "Fatih", "Gaziosmanpaşa", "Güngören", "Kadıköy", "Kağıthane", "Kartal", "Küçükçekmece", "Maltepe", "Pendik", "Sancaktepe", "Sarıyer", "Silivri", "Sultanbeyli", "Sultangazi", "Şile", "Şişli", "Tuzla", "Ümraniye", "Üsküdar", "Zeytinburnu"],
            "Ankara": ["Akyurt", "Altındağ", "Ayaş", "Bala", "Beypazarı", "Çamlıdere", "Çankaya", "Çubuk", "Elmadağ", "Etimesgut", "Evren", "Gölbaşı", "Güdül", "Haymana", "Kahramankazan", "Kalecik", "Keçiören", "Kızılcahamam", "Mamak", "Nallıhan", "Polatlı", "Pursaklar", "Sincan", "Şereflikoçhisar", "Yenimahalle"],
            "İzmir": ["Aliağa", "Balçova", "Bayındır", "Bayraklı", "Bergama", "Beydağ", "Bornova", "Buca", "Çeşme", "Çiğli", "Dikili", "Foça", "Gaziemir", "Güzelbahçe", "Karabağlar", "Karaburun", "Karşıyaka", "Kemalpaşa", "Kınık", "Kiraz", "Konak", "Menderes", "Menemen", "Narlıdere", "Ödemiş", "Seferihisar", "Selçuk", "Tire", "Torbalı", "Urla"]
            // Diğer tüm iller buraya eklenebilir.
        };

        const ilSelect = document.getElementById('il-select');
        const ilceSelect = document.getElementById('ilce-select');

        // İlleri doldur
        Object.keys(data).forEach(il => {
            const opt = document.createElement('option');
            opt.value = il;
            opt.text = il;
            ilSelect.add(opt);
        });

        function ilceGuncelle() {
            ilceSelect.innerHTML = '<option value="">İlçe Seçiniz</option>';
            const secilenIl = ilSelect.value;
            if(data[secilenIl]) {
                data[secilenIl].forEach(ilce => {
                    const opt = document.createElement('option');
                    opt.value = ilce;
                    opt.text = ilce;
                    ilceSelect.add(opt);
                });
            }
        }

        function toggleKalemler(id) {
            const box = document.getElementById(id);
            box.style.display = box.style.display === "block" ? "none" : "block";
        }
    </script>
</body>
</html>