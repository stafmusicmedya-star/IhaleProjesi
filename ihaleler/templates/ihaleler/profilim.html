{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEYSA TEKNİK | Profilim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --meysa-blue: #1a5695; --meysa-green: #28a745; --bg-gray: #f4f7fa; --text-primary: #2d2d2d; --border-mid: #e0e0e0; }
        body { background-color: var(--bg-gray); font-family: 'Segoe UI', sans-serif; color: var(--text-primary); }
        
        /* NAVBAR */
        .ekap-navbar { padding: 15px 40px; background: white; border-bottom: 1px solid var(--border-mid); display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 1000; }
        .nav-capsule { background: #f8f9fa; border-radius: 50px; padding: 6px 20px; border: 1px solid var(--border-mid); display: flex; gap: 14px; align-items: center; }
        .nav-capsule a { text-decoration: none; color: var(--text-primary); font-size: 13px; font-weight: 500; transition: 0.2s; white-space: nowrap; }
        .nav-capsule a:hover { color: var(--meysa-blue); }
        .nav-capsule a.active { color: var(--meysa-blue); font-weight: 700; }
        
        .nav-upload-btn { 
            background: var(--meysa-blue); color: white !important; padding: 6px 15px; border-radius: 20px; 
            font-weight: 800 !important; box-shadow: 0 2px 8px rgba(26, 86, 149, 0.3);
        }
        .nav-user-block { display: flex; align-items: center; gap: 10px; background: #f8f9fa; padding: 8px 14px; border-radius: 50px; border: 1px solid #e9ecef; }
        .nav-user-block .nav-username { font-size: 13px; font-weight: 600; color: var(--meysa-blue); text-transform: uppercase; letter-spacing: 0.3px; }
        .nav-user-block .btn-logout { font-size: 12px; padding: 5px 12px; border-radius: 20px; font-weight: 600; }

        /* PROFIL KARTI TASARIMI */
        .profile-container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .main-card { background: white; border-radius: 15px; border: 1px solid #e0e6ed; box-shadow: 0 4px 12px rgba(0,0,0,0.05); overflow: hidden; }
        .sidebar-user { background: linear-gradient(180deg, #f8f9fa 0%, #ffffff 100%); border-right: 1px solid #eee; padding: 30px; text-align: center; }
        .avatar-circle { width: 100px; height: 100px; background: var(--meysa-blue); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; margin: 0 auto 15px; border: 4px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        .section-title { font-size: 14px; font-weight: 700; color: var(--meysa-blue); border-bottom: 2px solid #f0f0f0; padding-bottom: 8px; margin-bottom: 15px; display: flex; align-items: center; text-transform: uppercase; }
        
        /* ISTATISTIK KARTLARI */
        .stat-card { background: white; border: 1px solid #eee; border-radius: 12px; padding: 15px; display: flex; align-items: center; gap: 15px; transition: 0.3s; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .stat-icon { width: 45px; height: 45px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        /* RAPOR & MESAI ITEM STİLLERİ */
        .rapor-item, .history-mesai-item { background: #f8f9fa; border: 1px solid #eee; border-radius: 10px; padding: 12px; margin-bottom: 10px; border-left: 4px solid var(--meysa-blue); }
        .rapor-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 5px; cursor: pointer; border: 1px solid #ddd; }
        
        .timeline-item { padding-left: 20px; position: relative; margin-bottom: 15px; border-left: 2px solid #eee; margin-left: 10px; font-size: 13px; }
        .timeline-item::before { content: ""; position: absolute; left: -7px; top: 4px; width: 12px; height: 12px; background: var(--meysa-green); border-radius: 50%; border: 2px solid white; }
        
        .mesai-card { background: #fffcf0; border: 1px solid #fef3c7; border-radius: 10px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
    </style>
</head>
<body>

    <nav class="ekap-navbar">
    <a href="{% url 'ana_sayfa' %}">
        <img src="{% static 'img/meysa_logo.jpeg' %}" style="height: 55px;">
    </a>

    <div class="nav-capsule">
        <a href="{% url 'ana_sayfa' %}">Anasayfa</a>
        <a href="{% url 'ihale_listesi' %}">İhaleler</a>
        <a href="{% url 'dogrudan_temin_listesi' %}">Doğrudan Teminler</a>

        <a href="{% url 'dosya_yukleme' %}" class="nav-upload-btn">
            <i class="fas fa-cloud-upload-alt me-1"></i> Dosya Yükleme
        </a>

        <a href="{% url 'arabalar' %}">Arabalar</a>

        <div style="width:1px; height:20px; background:#ddd;"></div>
        <a href="{% url 'analiz' %}" class="active">Analiz</a>
        <a href="{% url 'mesailerim' %}">Mesailerim</a>
        <a href="{% url 'profilim' %}" style="color: #28a745; font-weight: 700;">Profilim</a>
        <a href="{% url 'iletisim' %}">İletişim <i class="fas fa-phone-alt ms-1"></i></a>
    </div>

    <div class="nav-user-block">
        <span class="nav-username">{{ user.username }}</span>
        <form action="/admin/logout/" method="post" style="display:inline; margin:0;">{% csrf_token %}<button type="submit" class="btn btn-sm btn-outline-danger btn-logout">Çıkış</button></form>
    </div>
</nav>

    <div class="profile-container">
        <div class="row mb-4 g-3">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-primary text-white"><i class="fas fa-briefcase"></i></div>
                    <div><div class="text-muted small">Aktif Görevler</div><div class="fw-bold h5 mb-0">4</div></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-success text-white"><i class="fas fa-check-double"></i></div>
                    <div><div class="text-muted small">Tamamlanan</div><div class="fw-bold h5 mb-0">12</div></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-warning text-dark"><i class="fas fa-clock"></i></div>
                    <div><div class="text-muted small">Bu Ayki Mesai</div><div class="fw-bold h5 mb-0">160s</div></div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon bg-info text-white"><i class="fas fa-camera"></i></div>
                    <div><div class="text-muted small">Yüklenen Rapor</div><div class="fw-bold h5 mb-0">28</div></div>
                </div>
            </div>
        </div>

        <div class="main-card row g-0">
            <div class="col-md-4 sidebar-user">
                <div class="avatar-circle"><i class="fas fa-user-tie"></i></div>
                <h4 class="fw-bold mb-1">{{ user.get_full_name|default:user.username }}</h4>
                <p class="text-muted small mb-4">Teknik Personel</p>
                <div class="text-start mb-4 small">
                    <div class="mb-2"><i class="fas fa-envelope me-2 text-primary"></i> {{ user.email|default:"info@meysateknik.com" }}</div>
                    <div class="mb-2"><i class="fas fa-calendar-check me-2 text-primary"></i> Katılım: {{ user.date_joined|date:"d.m.Y" }}</div>
                </div>
                <hr>
                <div class="text-start">
                    <h6 class="section-title"><i class="fas fa-car me-2"></i>Zimmetli Araç</h6>
                    <div style="background: #f0f7ff; border: 1px solid #d1e3f8; border-radius: 10px; padding: 15px;">
                        <div class="d-flex align-items-center gap-3">
                            <i class="fas fa-truck-moving fa-2x text-primary"></i>
                            <div class="text-start">
                                <div class="fw-bold small">06 MYS 123</div>
                                <div class="text-muted" style="font-size: 11px;">Ford Transit Custom</div>
                            </div>
                        </div>
                        <div class="mt-3 pt-2 border-top border-primary-subtle small" style="font-size: 11px;">
                            <div class="d-flex justify-content-between mb-1">
                                <span class="text-muted"><i class="far fa-calendar-alt me-1"></i> Alış Tarihi:</span>
                                <span class="fw-bold">01.01.2026</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span class="text-muted"><i class="fas fa-tachometer-alt me-1"></i> Alış KM:</span>
                                <span class="fw-bold">42.500 km</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-8 p-4">
                <div class="mb-5">
                    <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
                        <h6 class="fw-bold text-uppercase mb-0" style="font-size: 14px; color: var(--meysa-blue);">
                            <i class="fas fa-tasks me-2"></i>Atandığı Görevler & İş Bildirimi
                        </h6>
                        <button class="btn btn-sm btn-outline-primary fw-bold" style="font-size: 11px;" data-bs-toggle="modal" data-bs-target="#historyModal">
                            <i class="fas fa-history me-1"></i> RAPOR GEÇMİŞİ
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-sm border small align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>İhale/İş Adı</th>
                                    <th>Kurum</th>
                                    <th class="text-center">İşlem</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Cihaz Bakım / Onarım</strong></td>
                                    <td>
                                        <div class="d-flex flex-wrap gap-1">
                                            <span class="badge bg-light text-dark border small" style="font-size: 10px;">Ankara Şehir Hastanesi</span>
                                            <span class="badge bg-light text-dark border small" style="font-size: 10px;">Cerrahpaşa Tıp Fak.</span>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <button class="btn btn-xs btn-success py-1 px-3" style="font-size: 11px;" data-bs-toggle="modal" data-bs-target="#uploadModal">
                                            <i class="fas fa-camera me-1"></i> Rapor Yükle
                                        </button>
                                    </td>
                                </tr>
                                {% for g in gorevler|slice:":4" %}
                                <tr>
                                    <td><strong>{{ g.ihale_adi }}</strong></td>
                                    <td>{{ g.kurum }}</td>
                                    <td class="text-center">
                                        <button class="btn btn-xs btn-success py-1 px-3" style="font-size: 11px;" data-bs-toggle="modal" data-bs-target="#uploadModal">
                                            <i class="fas fa-camera me-1"></i> Rapor Yükle
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        <div class="text-center mt-2">
                            <button class="btn btn-sm btn-link text-decoration-none fw-bold" style="font-size: 11px;">
                                <i class="fas fa-chevron-down me-1"></i> TÜM GÖREVLERİ GÖR
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <h6 class="section-title"><i class="fas fa-history me-2"></i>Son İşlemlerin</h6>
                        <div class="timeline-container">
                            <div class="timeline-item"><div class="fw-bold">X-Ray Parça Değişimi</div><div class="text-muted" style="font-size: 11px;">05.02.2026</div></div>
                            <div class="timeline-item"><div class="fw-bold">Periyodik Bakım</div><div class="text-muted" style="font-size: 11px;">04.02.2026</div></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6 class="section-title"><i class="fas fa-stopwatch me-2"></i>Mesai Kayıtları</h6>
                        <div class="mesai-card">
                            <div><div class="fw-bold">Bugün</div><div class="text-muted" style="font-size: 11px;">Teknik Servis Desteği</div></div>
                            <span class="badge bg-warning text-dark">9 Saat</span>
                        </div>
                        <button class="btn btn-outline-primary btn-sm w-100 mt-2 fw-bold" data-bs-toggle="modal" data-bs-target="#mesaiHistoryModal">
                            GEÇMİŞ MESAİLER
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title" style="font-size: 15px;"><i class="fas fa-file-upload me-2"></i>Yeni İş Raporu Oluştur</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form action="#" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Fotoğraflar</label>
                            <input type="file" class="form-control form-control-sm" name="is_resim" multiple>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">Teknik Detaylar / Notlar</label>
                            <textarea class="form-control form-control-sm" rows="3" placeholder="Hangi işlemler yapıldı?"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer bg-light"><button type="submit" class="btn btn-success btn-sm w-100">RAPORU KAYDET VE GÖNDER</button></div>
                </form>
            </div>
        </div>
    </div>

    <div class="modal fade" id="historyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" style="font-size: 15px;"><i class="fas fa-history me-2"></i>Geçmiş İş Raporlarım</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="rapor-item">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0 fw-bold text-primary" style="font-size: 13px;">Ankara Şehir Hastanesi - X-Ray Bakımı</h6>
                            <span class="small text-muted">01.02.2026</span>
                        </div>
                        <p class="small text-secondary mb-2">Güç kaynağı değiştirildi.</p>
                        <div class="d-flex gap-2">
                            <img src="https://via.placeholder.com/150" class="rapor-thumb">
                            <img src="https://via.placeholder.com/150" class="rapor-thumb">
                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="mesaiHistoryModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title fw-bold" style="font-size: 15px;"><i class="fas fa-stopwatch me-2"></i>Geçmiş Mesai Kayıtlarım</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="history-mesai-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold" style="font-size: 13px;">04.02.2026</div>
                                <div class="text-muted small">Cihaz Kurulumu - Cerrahpaşa</div>
                            </div>
                            <span class="badge bg-warning text-dark">8 Saat</span>
                        </div>
                    </div>
                    <div class="history-mesai-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold" style="font-size: 13px;">03.02.2026</div>
                                <div class="text-muted small">Arıza Müdahale - Numune Hast.</div>
                            </div>
                            <span class="badge bg-warning text-dark">10 Saat</span>
                        </div>
                    </div>
                    {% for m in tum_mesailer %}
                    <div class="history-mesai-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold" style="font-size: 13px;">{{ m.tarih }}</div>
                                <div class="text-muted small">{{ m.aciklama }}</div>
                            </div>
                            <span class="badge bg-warning text-dark">{{ m.sure }} Saat</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer bg-light py-1 text-center">
                    <small class="text-muted w-100">Son 30 günlük kayıtlar listelenmektedir.</small>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>